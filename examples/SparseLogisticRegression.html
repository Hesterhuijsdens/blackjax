
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Sparse logistic regression &#8212; Blackjax</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MCMC sampling" href="../mcmc.html" />
    <link rel="prev" title="Regime switching Hidden Markov model" href="RegimeSwitchingModel.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/blackjax.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Blackjax</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  HOW TO
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../howto_use_ppl.html">
   Use the model I built with X?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="howto_use_aesara.html">
     Use with Aesara models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="howto_use_numpyro.html">
     Use with Numpyro models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="howto_use_oryx.html">
     Use with Oryx models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="howto_use_tfp.html">
     Use with TFP models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="howto_sample_multiple_chains.html">
   Sample with multiple chains?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="howto_custom_gradients.html">
   Use custom gradients?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="howto_other_frameworks.html">
   Use non-JAX log-prob functions?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Blackjax by example
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../examples.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Introduction.html">
     A Quick Introduction to Blackjax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LogisticRegression.html">
     Bayesian Logistic Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LogisticRegressionWithLatentGaussianSampler.html">
     Bayesian Logistic Regression With Latent Gaussian Sampler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="TemperedSMC.html">
     Use Tempered SMC to Improve Exploration of MCMC Methods.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="HierarchicalBNN.html">
     Hierarchical Bayesian Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="PeriodicOrbitalMCMC.html">
     Periodic Orbital MCMC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="GP_EllipticalSliceSampler.html">
     Gaussian Regression with the Elliptical Slice Sampler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="GP_Marginal.html">
     Bayesian Regression With Latent Gaussian Sampler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="SGMCMC.html">
     MNIST Digit Recognition With a 3-Layer Perceptron
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="change_of_variable_hmc.html">
     Change of Variable in HMC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Pathfinder.html">
     Pathfinder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RegimeSwitchingModel.html">
     Regime switching Hidden Markov model
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Sparse logistic regression
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mcmc.html">
   MCMC sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../sgmcmc.html">
   Stochastic gradient MCMC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../smc.html">
   Sequential Monte Carlo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../vi.html">
   Variational Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../adaptation.html">
   Adaptation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../diagnostics.html">
   Diagnostics
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/blackjax-devs/blackjax"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Sparse logistic regression</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="sparse-logistic-regression">
<h1>Sparse logistic regression<a class="headerlink" href="#sparse-logistic-regression" title="Permalink to this headline">#</a></h1>
<p>This example models a logistic regression with hierarchies on the scale of the independent variable’s parameters that function as a proxy for variable selection. We give the independent variable’s regressors <span class="math notranslate nohighlight">\(\beta\)</span> a prior mean of 0 and global <span class="math notranslate nohighlight">\(\tau\)</span> and local <span class="math notranslate nohighlight">\(\lambda\)</span> scale parameters with strong prior information around 0, thus allowing these parameters to a posteriori degenerate at 0, hence excluding its independent variable from the model. These type of hierarchies on the prior scale of a parameter create funnel geometries that are hard to efficiently explore without local or global structure of the target.</p>
<p>The model is run on its non-centered parametrization \citep{papaspiliopoulos2007general} with data from the numerical version of the <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/statlog+(german+credit+data)">German credit dataset</a>. The target posterior is defined by its likelihood</p>
<p>$$
L(\mathbf{y}|\beta, \lambda, \tau) = \prod_i \text{Beta}(y_i;\sigma((\tau \lambda \odot \beta)^T X_i))
$$</p>
<p>with <span class="math notranslate nohighlight">\(\sigma\)</span> the sigmoid function, and prior</p>
<p>$$
\pi_0(\beta, \lambda, \tau) = \text{Gamma}(\tau;1/2, 1/2)\prod_i \mathcal{N}(\beta_i;0, 1)\text{Gamma}(\lambda_i;1/2, 1/2)
$$</p>
<div class="cell tag_remove-stderr docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import jax
import jax.numpy as jnp
import jax.random as jrnd
import numpy as np
import pandas as pd
from jax.scipy.special import expit
from jax.scipy.stats import bernoulli, gamma, norm
from numpyro.diagnostics import print_summary

import blackjax


class HorseshoeLogisticReg:
    def __init__(self, X, y) -&gt; None:
        self.X = X
        self.y = y

    def initialize_model(self, rng_key, n_chain):
        kb, kl, kt = jax.random.split(rng_key, 3)
        self.init_params = {
            &quot;beta&quot;: jax.random.normal(kb, (n_chain, self.X.shape[1])),
            &quot;lamda&quot;: jax.random.normal(kl, (n_chain, self.X.shape[1])),
            &quot;tau&quot;: jax.random.normal(kt, (n_chain,)),
        }

    def logprob(self, beta, lamda, tau):  # non-centered
        # priors
        lprob = (
            jnp.sum(
                norm.logpdf(beta, loc=0.0, scale=1.0)
                + gamma.logpdf(jnp.exp(lamda), a=0.5, loc=0.0, scale=2.0)
                + lamda
            )
            + gamma.logpdf(jnp.exp(tau), a=0.5, loc=0.0, scale=2.0)
            + tau
        )
        # likelihood
        logit = jnp.sum(self.X * (jnp.exp(tau) * beta * jnp.exp(lamda)), axis=1)
        p = jnp.clip(expit(logit), a_min=1e-6, a_max=1 - 1e-6)
        lprob += jnp.sum(bernoulli.logpmf(self.y, p))
        return lprob

    def logprob_fn(self, x):
        return self.logprob(**x)


def inference_loop(rng, init_state, kernel, n_iter):
    keys = jrnd.split(rng, n_iter)

    def step(state, key):
        state, info = kernel(key, state)
        return state, (state, info)

    _, (states, info) = jax.lax.scan(step, init_state, keys)
    return states, info


url = &quot;https://archive.ics.uci.edu/ml/machine-learning-databases/statlog/german/german.data-numeric&quot;
data = pd.read_table(url, header=None, delim_whitespace=True)
y = -1 * (data.iloc[:, -1].values - 2)
X = (
    data.iloc[:, :-1]
    .apply(lambda x: -1 + (x - x.min()) * 2 / (x.max() - x.min()), axis=0)
    .values
)
X = np.concatenate([np.ones((1000, 1)), X], axis=1)
N_OBS, N_REG = X.shape

N_PARAM = N_REG * 2 + 1
dist = HorseshoeLogisticReg(X, y)

[n_chain, n_warm, n_iter] = [128, 20000, 10000]
ksam, kinit = jrnd.split(jrnd.PRNGKey(0), 2)
dist.initialize_model(kinit, n_chain)

tic1 = pd.Timestamp.now()
k_warm, k_sample = jrnd.split(ksam)
warmup = blackjax.meads(dist.logprob_fn, n_chain)
adaptation_results = warmup.run(k_warm, dist.init_params, n_warm)
init_state = adaptation_results.state
kernel = adaptation_results.kernel


def one_chain(k_sam, init_state):
    state, info = inference_loop(k_sam, init_state, kernel, n_iter)
    return state.position, info


k_sample = jrnd.split(k_sample, n_chain)
samples, infos = jax.vmap(one_chain)(k_sample, init_state)
tic2 = pd.Timestamp.now()
print(&quot;Runtime for MEADS&quot;, tic2 - tic1)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Runtime for MEADS 0 days 00:02:28.363440
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print_summary(samples)
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                mean       std    median      5.0%     95.0%     n_eff     r_hat
   beta[0]      0.39      0.88      0.42     -1.13      1.82   7932.97      1.02
   beta[1]      1.15      0.57      1.06      0.27      2.01   4990.59      1.03
   beta[2]     -1.26      0.57     -1.19     -2.14     -0.36   5620.03      1.02
   beta[3]      1.11      0.57      1.02      0.22      1.95   6873.45      1.02
   beta[4]     -0.46      0.84     -0.48     -1.88      0.94   8038.22      1.02
   beta[5]      0.96      0.56      0.86      0.13      1.77   4825.73      1.03
   beta[6]      0.66      0.69      0.61     -0.29      1.94   4902.90      1.03
   beta[7]      0.67      0.72      0.63     -0.37      1.99   4600.09      1.03
   beta[8]      0.04      0.81      0.04     -1.34      1.40   8618.94      1.01
   beta[9]     -0.65      0.70     -0.60     -1.92      0.29   4061.45      1.03
  beta[10]      0.36      0.83      0.37     -1.01      1.78   6679.58      1.02
  beta[11]      0.82      0.59      0.73      0.05      1.75   4818.57      1.03
  beta[12]     -0.45      0.82     -0.45     -1.85      0.91   7774.20      1.02
  beta[13]     -0.07      0.81     -0.06     -1.44      1.29   9492.74      1.01
  beta[14]      0.33      0.77      0.30     -0.94      1.68   8074.37      1.02
  beta[15]      0.72      0.73      0.69     -0.34      2.03   5711.43      1.02
  beta[16]     -0.89      0.57     -0.78     -1.73     -0.09   5233.26      1.03
  beta[17]      0.89      0.61      0.79      0.06      1.87   3778.80      1.04
  beta[18]     -0.68      0.73     -0.65     -2.02      0.34   4837.97      1.02
  beta[19]     -0.77      0.72     -0.74     -2.08      0.23   5800.62      1.02
  beta[20]     -0.51      0.75     -0.48     -1.85      0.68   6003.15      1.02
  beta[21]      0.35      0.78      0.34     -0.96      1.67   5830.83      1.02
  beta[22]      0.02      0.85      0.02     -1.40      1.42   8162.56      1.02
  beta[23]     -0.02      0.81     -0.02     -1.35      1.40   6488.87      1.02
  beta[24]     -0.04      0.82     -0.04     -1.41      1.35   8307.13      1.01
  lamda[0]     -1.38      2.20     -0.85     -4.50      1.62   4612.52      1.03
  lamda[1]      0.64      0.60      0.64     -0.35      1.63   4851.47      1.03
  lamda[2]      0.90      0.57      0.91     -0.03      1.84   5070.91      1.02
  lamda[3]      0.49      0.63      0.49     -0.54      1.55   5507.87      1.02
  lamda[4]     -1.32      2.14     -0.79     -4.33      1.55   5424.35      1.03
  lamda[5]      0.12      0.72      0.12     -1.07      1.30   4724.17      1.03
  lamda[6]     -0.99      1.85     -0.58     -3.46      1.48   2025.00      1.07
  lamda[7]     -0.96      1.85     -0.53     -3.48      1.51   1690.41      1.07
  lamda[8]     -2.50      2.28     -2.06     -5.78      0.90   4001.56      1.03
  lamda[9]     -0.97      1.81     -0.58     -3.39      1.49   2532.74      1.05
 lamda[10]     -1.74      2.21     -1.23     -4.92      1.33   6216.83      1.02
 lamda[11]     -0.41      1.16     -0.29     -1.83      1.37   2370.19      1.06
 lamda[12]     -1.47      2.12     -0.96     -4.51      1.41   5153.07      1.02
 lamda[13]     -2.51      2.32     -2.08     -5.79      0.84   5153.12      1.03
 lamda[14]     -2.23      2.19     -1.78     -5.45      0.98   5513.45      1.03
 lamda[15]     -0.66      1.77     -0.24     -3.11      1.62   4355.89      1.03
 lamda[16]     -0.22      1.02     -0.17     -1.50      1.23   1463.60      1.08
 lamda[17]     -0.23      1.19     -0.08     -1.65      1.46   1887.33      1.06
 lamda[18]     -0.80      1.79     -0.38     -3.28      1.56   3606.55      1.03
 lamda[19]     -0.45      1.60     -0.08     -2.70      1.69   2843.55      1.04
 lamda[20]     -1.41      2.04     -0.94     -4.27      1.30   2676.98      1.05
 lamda[21]     -1.83      2.09     -1.38     -4.92      1.16   3947.06      1.03
 lamda[22]     -2.00      2.18     -1.56     -5.19      1.11   4840.59      1.03
 lamda[23]     -2.55      2.36     -2.09     -5.93      0.90   4243.65      1.03
 lamda[24]     -2.65      2.25     -2.25     -5.99      0.70   5326.72      1.02
       tau     -0.83      0.40     -0.83     -1.50     -0.18   4173.80      1.03
</pre></div>
</div>
</div>
</div>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="RegimeSwitchingModel.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Regime switching Hidden Markov model</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../mcmc.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">MCMC sampling</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Blackjax developers<br/>
  
      &copy; Copyright 2022, The Blackjax developers.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>